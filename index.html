<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MSP ‚Äì Mandarin Practice v3.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      min-height: 100vh;
      align-items: stretch;
      justify-content: center;
    }
    .app {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
      padding: 16px 16px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .card {
      background: radial-gradient(circle at top, #1e293b, #020617);
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.18);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .title-block h1 {
      font-size: 1.2rem;
      margin: 0;
      letter-spacing: 0.02em;
    }
    .title-block p {
      margin: 2px 0 0;
      font-size: 0.78rem;
      color: #9ca3af;
    }
    .pill {
      font-size: 0.72rem;
      padding: 4px 8px;
      background: rgba(56, 189, 248, 0.1);
      color: #38bdf8;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.4);
      white-space: nowrap;
    }
    .mode-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .mode-btn {
      flex: 1 1 30%;
      min-width: 30%;
      font-size: 0.8rem;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.94);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .mode-btn span.icon { font-size: 0.95rem; }
    .mode-btn.active {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background: radial-gradient(circle at top left,
        rgba(56, 189, 248, 0.2),
        rgba(15, 23, 42, 0.98));
    }

    .phrase-card {
      margin-top: 8px;
      padding: 14px 12px;
      border-radius: 14px;
      background: linear-gradient(
        135deg,
        rgba(15, 118, 110, 0.25),
        rgba(30, 64, 175, 0.7)
      );
      border: 1px solid rgba(56, 189, 248, 0.45);
    }

    .phrase-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
    }
    .tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #cbd5f5;
    }
    .small-label {
      font-size: 0.75rem;
      color: #d1d5db;
      opacity: 0.9;
      text-align: right;
    }

    .hanzi {
      font-size: 1.6rem;
      margin: 4px 0 2px;
      line-height: 1.3;
    }
    .pinyin {
      font-size: 0.95rem;
      color: #d1fae5;
      margin: 0 0 4px;
    }
    .english {
      font-size: 0.9rem;
      color: #e5e7eb;
      opacity: 0.97;
      margin: 0;
    }

    .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .primary-btn,
    .ghost-btn,
    .secondary-btn {
      font-size: 0.8rem;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.6);
      background: rgba(8, 47, 73, 0.9);
      color: #e0f2fe;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .ghost-btn {
      background: transparent;
      border-color: rgba(148, 163, 184, 0.7);
      color: #d1d5db;
    }
    .secondary-btn {
      border-color: rgba(96, 165, 250, 0.8);
      background: rgba(15, 23, 42, 0.9);
      color: #bfdbfe;
    }

    .primary-btn:active,
    .ghost-btn:active,
    .secondary-btn:active,
    .mode-btn:active {
      transform: translateY(1px);
      opacity: 0.85;
    }

    .controls-row-2 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .footer {
      margin-top: auto;
      font-size: 0.7rem;
      text-align: center;
      color: #6b7280;
    }
    .hidden { display: none; }
    .pill-small {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
    }
    .pill-on {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.2);
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="card">
      <div class="header">
        <div class="title-block">
          <h1>MSP ¬∑ Mandarin v3.0</h1>
          <p>HSK1‚Äì2 ¬∑ Everyday ¬∑ Retail ¬∑ Pharmacy</p>
        </div>
        <div class="pill" id="testModePill">Drill mode</div>
      </div>

      <div class="mode-row">
        <button class="mode-btn active" data-mode="all"><span class="icon">üé≤</span>All</button>
        <button class="mode-btn" data-mode="everyday"><span class="icon">üå§Ô∏è</span>Everyday</button>
        <button class="mode-btn" data-mode="retail"><span class="icon">üõí</span>Retail</button>
        <button class="mode-btn" data-mode="pharmacy"><span class="icon">üíä</span>Pharmacy</button>
        <button class="mode-btn" data-mode="hsk1"><span class="icon">‚ë†</span>HSK 1</button>
        <button class="mode-btn" data-mode="hsk2"><span class="icon">‚ë°</span>HSK 2</button>
        <button class="mode-btn" data-mode="favorites"><span class="icon">‚≠ê</span>Favorites</button>
      </div>

      <div class="phrase-card" id="phraseCard">
        <div class="phrase-top-row">
          <span class="tag" id="categoryTag">Warm-up</span>
          <span class="small-label" id="indexLabel">Seen 0 / 0</span>
        </div>

        <div>
          <div class="hanzi" id="hanzi">ÁÇπÂáª‚ÄúÊñ∞Áü≠ËØ≠‚Äù</div>
          <div class="pinyin" id="pinyin">Di«én‚Äãjƒ´ ‚Äúxƒ´n du«ény«î‚Äù</div>
          <p class="english" id="english">Tap "New phrase" to begin.</p>
        </div>

        <div class="controls-row">
          <button class="primary-btn" id="newPhraseBtn">üîÅ New phrase</button>
          <button class="ghost-btn" id="toggleRevealBtn">üëÅ Hide meaning</button>
        </div>

        <div class="controls-row-2">
          <button class="secondary-btn" id="audioBtn">üîä Play audio</button>
          <button class="secondary-btn" id="favoriteBtn">‚≠ê Add to favorites</button>
          <button class="ghost-btn" id="testModeBtn">üß™ Test mode: Off</button>
        </div>
      </div>
    </section>

    <div class="footer">
      MSP v3.0 ¬∑ Smart random ¬∑ Test ¬∑ Audio ¬∑ Favorites
    </div>
  </div>

  <script>
    // --------- PHRASE BANK (can be extended easily) ---------
    const phrases = [
      // ---------- EVERYDAY ----------
      { category: "everyday", label: "Everyday ¬∑ Greeting", hanzi: "‰Ω†Â•Ω„ÄÇ", pinyin: "N«ê h«éo.", english: "Hello." },
      { category: "everyday", label: "Everyday ¬∑ Greeting", hanzi: "Êó©‰∏äÂ•Ω„ÄÇ", pinyin: "Z«éoshang h«éo.", english: "Good morning." },
      { category: "everyday", label: "Everyday ¬∑ Greeting", hanzi: "Êôö‰∏äÂ•Ω„ÄÇ", pinyin: "W«énshang h«éo.", english: "Good evening." },
      { category: "everyday", label: "Everyday ¬∑ Polite", hanzi: "Ë∞¢Ë∞¢„ÄÇ", pinyin: "Xi√®xie.", english: "Thank you." },
      { category: "everyday", label: "Everyday ¬∑ Polite", hanzi: "‰∏çÂ•ΩÊÑèÊÄù„ÄÇ", pinyin: "B√π h«éoy√¨si.", english: "Excuse me / Sorry (polite)." },
      { category: "everyday", label: "Everyday ¬∑ Polite", hanzi: "ÂØπ‰∏çËµ∑„ÄÇ", pinyin: "Du√¨buq«ê.", english: "I‚Äôm sorry." },
      { category: "everyday", label: "Everyday ¬∑ Polite", hanzi: "Ê≤°ÂÖ≥Á≥ª„ÄÇ", pinyin: "M√©i guƒÅnxi.", english: "It's okay / No problem." },
      { category: "everyday", label: "Everyday ¬∑ Repeat", hanzi: "ÂèØ‰ª•ÂÜçËØ¥‰∏ÄÈÅçÂêóÔºü", pinyin: "Kƒõy«ê z√†i shu≈ç y√≠ bi√†n ma?", english: "Could you say that again?" },
      { category: "everyday", label: "Everyday ¬∑ Slow", hanzi: "ÂèØ‰ª•ËØ¥ÊÖ¢‰∏ÄÁÇπÂêóÔºü", pinyin: "Kƒõy«ê shu≈ç m√†n y√¨di«én ma?", english: "Can you speak a bit slower?" },
      { category: "everyday", label: "Everyday ¬∑ Don‚Äôt understand", hanzi: "ÊàëÂê¨‰∏çÊáÇ„ÄÇ", pinyin: "W«í tƒ´ng b√π d«íng.", english: "I don‚Äôt understand (hearing)." },
      { category: "everyday", label: "Everyday ¬∑ Don‚Äôt understand", hanzi: "ÊàëÁúã‰∏çÊáÇ„ÄÇ", pinyin: "W«í k√†n b√π d«íng.", english: "I don‚Äôt understand (reading)." },
      { category: "everyday", label: "Everyday ¬∑ Meaning", hanzi: "ËøôÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü", pinyin: "Zh√® sh√¨ sh√©nme y√¨si?", english: "What does this mean?" },
      { category: "everyday", label: "Everyday ¬∑ Name", hanzi: "‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü", pinyin: "N«ê ji√†o sh√©nme m√≠ngzi?", english: "What is your name?" },
      { category: "everyday", label: "Everyday ¬∑ Name", hanzi: "ÊàëÂè´‚Ä¶‚Ä¶„ÄÇ", pinyin: "W«í ji√†o ‚Ä¶‚Ä¶.", english: "My name is ‚Ä¶" },
      { category: "everyday", label: "Everyday ¬∑ From", hanzi: "‰Ω†ÊòØÂì™ÂõΩ‰∫∫Ôºü", pinyin: "N«ê sh√¨ n«é gu√≥ r√©n?", english: "Which country are you from?" },
      { category: "everyday", label: "Everyday ¬∑ From", hanzi: "ÊàëÊòØÁæéÂõΩ‰∫∫„ÄÇ", pinyin: "W«í sh√¨ Mƒõigu√≥ r√©n.", english: "I‚Äôm American." },
      { category: "everyday", label: "Everyday ¬∑ Live", hanzi: "‰Ω†‰ΩèÂú®Âì™ÂÑøÔºü", pinyin: "N«ê zh√π z√†i n«ér?", english: "Where do you live?" },
      { category: "everyday", label: "Everyday ¬∑ Live", hanzi: "Êàë‰ΩèÂú®‰ºäÂà©ËØ∫‰ºäÂ∑û„ÄÇ", pinyin: "W«í zh√π z√†i Yƒ´l√¨nu√≤yƒ´ zh≈çu.", english: "I live in Illinois." },
      { category: "everyday", label: "Everyday ¬∑ Language", hanzi: "‰Ω†‰ºöËØ¥Ê±âËØ≠ÂêóÔºü", pinyin: "N«ê hu√¨ shu≈ç H√†ny«î ma?", english: "Can you speak Chinese?" },
      { category: "everyday", label: "Everyday ¬∑ Language", hanzi: "Êàë‰ºöËØ¥‰∏ÄÁÇπÂÑø„ÄÇ", pinyin: "W«í hu√¨ shu≈ç y√¨di«énr.", english: "I can speak a little." },
      { category: "everyday", label: "Everyday ¬∑ Busy", hanzi: "‰Ω†‰ªäÂ§©ÂøôÂêóÔºü", pinyin: "N«ê jƒ´ntiƒÅn m√°ng ma?", english: "Are you busy today?" },
      { category: "everyday", label: "Everyday ¬∑ Busy", hanzi: "ÊàëÊúâÁÇπÂÑøÂøô„ÄÇ", pinyin: "W«í y«íudi«énr m√°ng.", english: "I‚Äôm a bit busy." },
      { category: "everyday", label: "Everyday ¬∑ Job", hanzi: "‰Ω†ÂÅö‰ªÄ‰πàÂ∑•‰ΩúÔºü", pinyin: "N«ê zu√≤ sh√©nme g≈çngzu√≤?", english: "What do you do for work?" },
      { category: "everyday", label: "Everyday ¬∑ Bathroom", hanzi: "ËØ∑ÈóÆÔºåÂéïÊâÄÂú®Âì™ÂÑøÔºü", pinyin: "Q«êngw√®n, c√®su«í z√†i n«ér?", english: "Where is the bathroom?" },
      { category: "everyday", label: "Everyday ¬∑ Time", hanzi: "Áé∞Âú®Âá†ÁÇπÔºü", pinyin: "Xi√†nz√†i j«ê di«én?", english: "What time is it now?" },
      { category: "everyday", label: "Everyday ¬∑ Date", hanzi: "‰ªäÂ§©Âá†Âè∑Ôºü", pinyin: "Jƒ´ntiƒÅn j«ê h√†o?", english: "What‚Äôs today‚Äôs date?" },
      { category: "everyday", label: "Everyday ¬∑ Eat", hanzi: "‰Ω†ÂêÉÈ•≠‰∫ÜÂêóÔºü", pinyin: "N«ê chƒ´f√†n le ma?", english: "Have you eaten?" },
      { category: "everyday", label: "Everyday ¬∑ Not eaten", hanzi: "ÊàëËøòÊ≤°ÂêÉ„ÄÇ", pinyin: "W«í h√°i m√©i chƒ´.", english: "I haven‚Äôt eaten yet." },

      // ---------- RETAIL ----------
      { category: "retail", label: "Retail ¬∑ Help", hanzi: "ÈúÄË¶ÅÂ∏ÆÂøôÂêóÔºü", pinyin: "X≈´y√†o bƒÅngm√°ng ma?", english: "Do you need help?" },
      { category: "retail", label: "Retail ¬∑ Help", hanzi: "ÊàëÂèØ‰ª•Â∏Æ‰Ω†Êâæ„ÄÇ", pinyin: "W«í kƒõy«ê bƒÅng n«ê zh«éo.", english: "I can help you find it." },
      { category: "retail", label: "Retail ¬∑ Location", hanzi: "Ëøô‰∏™Âú®ÈÇ£ËæπÁöÑË¥ßÊû∂‰∏ä„ÄÇ", pinyin: "Zh√®ge z√†i n√†biƒÅn de hu√≤ji√† sh√†ng.", english: "It's on the shelf over there." },
      { category: "retail", label: "Retail ¬∑ Sale", hanzi: "‰ªäÂ§©Ëøô‰∫õÂú®ÊâìÊäò„ÄÇ", pinyin: "Jƒ´ntiƒÅn zh√®xiƒì z√†i d«ézh√©.", english: "These are on sale today." },
      { category: "retail", label: "Retail ¬∑ Card", hanzi: "‰Ω†Êúâ‰ºöÂëòÂç°ÂêóÔºü", pinyin: "N«ê y«íu hu√¨yu√°n k«é ma?", english: "Do you have a rewards card?" },
      { category: "retail", label: "Retail ¬∑ Price check", hanzi: "ÊàëÂ∏Æ‰Ω†Áúã‰∏Ä‰∏ã‰ª∑Èí±„ÄÇ", pinyin: "W«í bƒÅng n«ê k√†n y√≠xi√† ji√†qi√°n.", english: "I'll check the price for you." },
      { category: "retail", label: "Retail ¬∑ Out of stock", hanzi: "Ëøô‰∏™Áé∞Âú®Ê≤°ÊúâË¥ß‰∫Ü„ÄÇ", pinyin: "Zh√®ge xi√†nz√†i m√©iy«íu hu√≤ le.", english: "We're out of stock right now." },
      { category: "retail", label: "Retail ¬∑ Back room", hanzi: "ÊàëÂéªÂêéÈù¢Â∏Æ‰Ω†ÁúãÁúã„ÄÇ", pinyin: "W«í q√π h√≤umi√†n bƒÅng n«ê k√†nkan.", english: "I'll check in the back." },
      { category: "retail", label: "Retail ¬∑ Other size", hanzi: "‰Ω†Ë¶ÅÂà´ÁöÑÈ¢úËâ≤ÊàñËÄÖÂ§ßÂ∞èÂêóÔºü", pinyin: "N«ê y√†o bi√© de y√°ns√® hu√≤zhƒõ d√†xi«éo ma?", english: "Do you want another size or color?" },
      { category: "retail", label: "Retail ¬∑ Receipt", hanzi: "‰Ω†Ë¶ÅÂ∞èÁ•®ÂêóÔºü", pinyin: "N«ê y√†o xi«éopi√†o ma?", english: "Do you want a receipt?" },

      // ---------- PHARMACY ----------
      { category: "pharmacy", label: "Pharmacy ¬∑ Purpose", hanzi: "‰Ω†Âú®ÊãøÂ§ÑÊñπËçØËøòÊòØ‰π∞Âà´ÁöÑÔºü", pinyin: "N«ê z√†i n√° ch«îfƒÅng y√†o h√°ish√¨ m«éi bi√© de?", english: "Are you picking up a prescription or something else?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ DOB", hanzi: "‰Ω†ÁöÑÁîüÊó•ÊòØÂá†ÊúàÂá†Âè∑Ôºü", pinyin: "N«ê de shƒìngr√¨ sh√¨ j«ê yu√® j«ê h√†o?", english: "What is your date of birth?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ Name confirm", hanzi: "ËØ∑ËØ¥‰∏Ä‰∏ã‰Ω†ÁöÑÂêçÂ≠ó„ÄÇ", pinyin: "Q«êng shu≈ç y√≠xi√† n«ê de m√≠ngzi.", english: "Please tell me your name." },
      { category: "pharmacy", label: "Pharmacy ¬∑ Allergies", hanzi: "‰Ω†ÂØπ‰ªÄ‰πàËçØËøáÊïèÂêóÔºü", pinyin: "N«ê du√¨ sh√©nme y√†o gu√≤m«ên ma?", english: "Are you allergic to any medicine?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ New refill", hanzi: "ËøôÊòØÊñ∞Â§ÑÊñπËøòÊòØÁª≠ËçØÔºü", pinyin: "Zh√® sh√¨ xƒ´n ch«îfƒÅng h√°ish√¨ x√π y√†o?", english: "Is this a new prescription or a refill?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ Wait", hanzi: "Â§ßÊ¶ÇË¶ÅÂçÅ‰∫îÂà∞‰∫åÂçÅÂàÜÈíü„ÄÇ", pinyin: "D√†g√†i y√†o sh√≠w«î d√†o √®rsh√≠ fƒìnzh≈çng.", english: "It‚Äôll take about 15‚Äì20 minutes." },
      { category: "pharmacy", label: "Pharmacy ¬∑ Directions", hanzi: "‰∏ÄÂ§©ÂêÉ‰∏§Ê¨°ÔºåÊØèÊ¨°‰∏ÄÁâá„ÄÇ", pinyin: "Y√¨tiƒÅn chƒ´ li«éng c√¨, mƒõi c√¨ y√≠ pi√†n.", english: "Take twice a day, one tablet each time." },
      { category: "pharmacy", label: "Pharmacy ¬∑ With food", hanzi: "ÊúÄÂ•ΩË∑üÈ•≠‰∏ÄËµ∑ÂêÉ„ÄÇ", pinyin: "Zu√¨ h«éo gƒìn f√†n y√¨q«ê chƒ´.", english: "Take it with food." },
      { category: "pharmacy", label: "Pharmacy ¬∑ Before bed", hanzi: "Áù°ËßâÂâçÂêÉ„ÄÇ", pinyin: "Shu√¨ji√†o qi√°n chƒ´.", english: "Take it before bed." },
      { category: "pharmacy", label: "Pharmacy ¬∑ As needed", hanzi: "‰∏çËàíÊúçÁöÑÊó∂ÂÄôÂÜçÂêÉ„ÄÇ", pinyin: "B√π sh≈´fu de sh√≠hou z√†i chƒ´.", english: "Take as needed." },
      { category: "pharmacy", label: "Pharmacy ¬∑ OTC", hanzi: "‰Ω†ÊòØÂú®ÊâæÂì™‰∏ÄÁßçËçØÔºü", pinyin: "N«ê sh√¨ z√†i zh«éo n«é y√¨ zh«íng y√†o?", english: "Which medicine are you looking for?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ Flu shot", hanzi: "‰Ω†‰ªäÂ§©Ë¶ÅÊâìÊµÅÊÑüÁñ´ËãóÂêóÔºü", pinyin: "N«ê jƒ´ntiƒÅn y√†o d«é li√∫g«én y√¨mi√°o ma?", english: "Do you want a flu shot today?" },
      { category: "pharmacy", label: "Pharmacy ¬∑ Vaccine area", hanzi: "ÊâìÈíàÁöÑÂú∞ÊñπÂú®ÈÇ£ËæπÔºåËØ∑Ë∑üÊàëÊù•„ÄÇ", pinyin: "D«ézhƒìn de d√¨fang z√†i n√†biƒÅn, q«êng gƒìn w«í l√°i.", english: "The vaccination area is over there, please follow me." },

      // ---------- HSK 1 ----------
      { category: "hsk1", label: "HSK1 ¬∑ Hello", hanzi: "‰Ω†Â•Ω„ÄÇ", pinyin: "N«ê h«éo.", english: "Hello." },
      { category: "hsk1", label: "HSK1 ¬∑ How are you", hanzi: "‰Ω†Â•ΩÂêóÔºü", pinyin: "N«ê h«éo ma?", english: "How are you?" },
      { category: "hsk1", label: "HSK1 ¬∑ Reply", hanzi: "ÊàëÂæàÂ•ΩÔºå‰Ω†Âë¢Ôºü", pinyin: "W«í hƒõn h«éo, n«ê ne?", english: "I'm very good, and you?" },
      { category: "hsk1", label: "HSK1 ¬∑ Goodbye", hanzi: "ÂÜçËßÅ„ÄÇ", pinyin: "Z√†iji√†n.", english: "Goodbye." },
      { category: "hsk1", label: "HSK1 ¬∑ Thanks", hanzi: "Ë∞¢Ë∞¢„ÄÇ", pinyin: "Xi√®xie.", english: "Thank you." },
      { category: "hsk1", label: "HSK1 ¬∑ Welcome", hanzi: "‰∏çÂÆ¢Ê∞î„ÄÇ", pinyin: "B√∫ k√®qi.", english: "You're welcome." },
      { category: "hsk1", label: "HSK1 ¬∑ Sorry", hanzi: "ÂØπ‰∏çËµ∑„ÄÇ", pinyin: "Du√¨buq«ê.", english: "Sorry." },
      { category: "hsk1", label: "HSK1 ¬∑ Bathroom", hanzi: "ËØ∑ÈóÆÔºåÂéïÊâÄÂú®Âì™ÂÑøÔºü", pinyin: "Q«êngw√®n, c√®su«í z√†i n«ér?", english: "Where is the bathroom?" },

      // ---------- HSK 2 ----------
      { category: "hsk2", label: "HSK2 ¬∑ Transport", hanzi: "‰Ω†ÊÄé‰πàÊù•ËøôÂÑøÔºü", pinyin: "N«ê zƒõnme l√°i zh√®r?", english: "How did you get here?" },
      { category: "hsk2", label: "HSK2 ¬∑ Bus", hanzi: "ÊàëÂùêÂÖ¨‰∫§ËΩ¶Êù•„ÄÇ", pinyin: "W«í zu√≤ g≈çngjiƒÅochƒì l√°i.", english: "I came by bus." },
      { category: "hsk2", label: "HSK2 ¬∑ Car", hanzi: "ÊàëÂºÄËΩ¶Êù•„ÄÇ", pinyin: "W«í kƒÅichƒì l√°i.", english: "I drove here." },
      { category: "hsk2", label: "HSK2 ¬∑ Weekend", hanzi: "‰Ω†Âë®Êú´ÂñúÊ¨¢ÂÅö‰ªÄ‰πàÔºü", pinyin: "N«ê zh≈çum√≤ x«êhuan zu√≤ sh√©nme?", english: "What do you like to do on weekends?" },
      { category: "hsk2", label: "HSK2 ¬∑ Study", hanzi: "‰Ω†Âú®Â≠¶‰ªÄ‰πàÔºü", pinyin: "N«ê z√†i xu√© sh√©nme?", english: "What are you studying?" },
      { category: "hsk2", label: "HSK2 ¬∑ Studying Chinese", hanzi: "ÊàëÂú®Â≠¶‰∏≠Êñá„ÄÇ", pinyin: "W«í z√†i xu√© Zh≈çngw√©n.", english: "I am learning Chinese." },
      { category: "hsk2", label: "HSK2 ¬∑ Difficulty", hanzi: "Â≠¶‰∏≠ÊñáÈöæ‰∏çÈöæÔºü", pinyin: "Xu√© Zh≈çngw√©n n√°n bu n√°n?", english: "Is Chinese hard?" },
      { category: "hsk2", label: "HSK2 ¬∑ Hard but fun", hanzi: "Êúâ‰∏ÄÁÇπÂÑøÈöæÔºå‰ΩÜÊòØÂæàÊúâÊÑèÊÄù„ÄÇ", pinyin: "Y«íu y√¨di«énr n√°n, d√†nsh√¨ hƒõn y«íuy√¨si.", english: "A bit hard, but very interesting." }
    ];

    // ---------- STATE ----------
    let currentMode = "all";
    let currentList = [];
    let shuffled = [];
    let index = 0;
    let revealed = true;
    let testMode = false;
    let currentPhrase = null;
    const favoriteKeys = new Set();

    // ---------- HELPERS ----------
    const hanziEl = document.getElementById("hanzi");
    const pinyinEl = document.getElementById("pinyin");
    const englishEl = document.getElementById("english");
    const tagEl = document.getElementById("categoryTag");
    const indexEl = document.getElementById("indexLabel");
    const toggleBtn = document.getElementById("toggleRevealBtn");
    const testModeBtn = document.getElementById("testModeBtn");
    const testModePill = document.getElementById("testModePill");
    const audioBtn = document.getElementById("audioBtn");
    const favoriteBtn = document.getElementById("favoriteBtn");

    function makeKey(p) {
      return `${p.hanzi}|${p.pinyin}|${p.english}`;
    }

    function getPhrasesForMode(mode) {
      if (mode === "all") return phrases;
      if (mode === "favorites") {
        return phrases.filter(p => favoriteKeys.has(makeKey(p)));
      }
      return phrases.filter(p => p.category === mode);
    }

    function shuffleArray(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function modeLabel(mode) {
      switch (mode) {
        case "everyday": return "Everyday";
        case "retail": return "Retail";
        case "pharmacy": return "Pharmacy";
        case "hsk1": return "HSK 1";
        case "hsk2": return "HSK 2";
        case "favorites": return "Favorites";
        default: return "All";
      }
    }

    function updateIndexLabel() {
      const total = currentList.length;
      if (!total || index < 0) {
        indexEl.textContent = "Seen 0 / 0";
      } else {
        indexEl.textContent = `Seen ${index + 1} / ${total}`;
      }
    }

    function updateFavoriteButton() {
      if (!currentPhrase) {
        favoriteBtn.textContent = "‚≠ê Add to favorites";
        return;
      }
      const key = makeKey(currentPhrase);
      if (favoriteKeys.has(key)) {
        favoriteBtn.textContent = "‚≠ê In favorites";
      } else {
        favoriteBtn.textContent = "‚≠ê Add to favorites";
      }
    }

    function applyRevealState() {
      const show = revealed || !currentPhrase ? true : false;
      if (testMode && currentPhrase) {
        // in test mode, revealed flag controls visibility
        if (revealed) {
          pinyinEl.style.display = "block";
          englishEl.style.display = "block";
          toggleBtn.textContent = "üëÅ Hide meaning";
        } else {
          pinyinEl.style.display = "none";
          englishEl.style.display = "none";
          toggleBtn.textContent = "üëÅ Show meaning";
        }
      } else {
        // normal drill mode
        pinyinEl.style.display = "block";
        englishEl.style.display = "block";
        toggleBtn.textContent = "üëÅ Hide meaning";
      }
    }

    // ---------- CORE ----------
    function setMode(mode) {
      currentMode = mode;

      document.querySelectorAll(".mode-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });

      currentList = getPhrasesForMode(currentMode);
      if (!currentList.length) {
        shuffled = [];
        index = -1;
        currentPhrase = null;
        hanziEl.textContent = "Ëøô‰∏™Ê®°ÂºèÁé∞Âú®Ê≤°ÊúâÁü≠ËØ≠„ÄÇ";
        pinyinEl.textContent = "Zh√®ge m√≥sh√¨ xi√†nz√†i m√©iy«íu du«ény«î.";
        englishEl.textContent = "There are no phrases in this mode yet.";
        tagEl.textContent = modeLabel(mode);
        updateIndexLabel();
        updateFavoriteButton();
        applyRevealState();
        return;
      }

      shuffled = shuffleArray(currentList);
      index = 0;
      currentPhrase = shuffled[index];
      fillPhrase();
    }

    function fillPhrase() {
      if (!currentList.length || index < 0) return;
      currentPhrase = shuffled[index];

      hanziEl.textContent = currentPhrase.hanzi;
      pinyinEl.textContent = currentPhrase.pinyin;
      englishEl.textContent = currentPhrase.english;

      tagEl.textContent = currentPhrase.label || modeLabel(currentMode);
      updateIndexLabel();

      // in test mode, each new phrase starts hidden
      if (testMode) {
        revealed = false;
      } else {
        revealed = true;
      }
      applyRevealState();
      updateFavoriteButton();
    }

    function nextPhrase() {
      if (!currentList.length) return;
      index++;
      if (index >= currentList.length) {
        // new cycle
        shuffled = shuffleArray(currentList);
        index = 0;
      }
      fillPhrase();
    }

    function toggleReveal() {
      if (!currentPhrase) return;
      if (!testMode) {
        // in normal mode, just toggle hide/show
        if (englishEl.style.display === "none") {
          pinyinEl.style.display = "block";
          englishEl.style.display = "block";
          toggleBtn.textContent = "üëÅ Hide meaning";
        } else {
          pinyinEl.style.display = "none";
          englishEl.style.display = "none";
          toggleBtn.textContent = "üëÅ Show meaning";
        }
      } else {
        // in test mode, revealed flag matters
        revealed = !revealed;
        applyRevealState();
      }
    }

    function toggleTestMode() {
      testMode = !testMode;
      if (testMode) {
        testModeBtn.textContent = "üß™ Test mode: On";
        testModePill.textContent = "Test mode";
        testModePill.classList.add("pill-on");
        revealed = false;
      } else {
        testModeBtn.textContent = "üß™ Test mode: Off";
        testModePill.textContent = "Drill mode";
        testModePill.classList.remove("pill-on");
        revealed = true;
      }
      applyRevealState();
    }

    function playAudio() {
      if (!currentPhrase) return;
      if (!("speechSynthesis" in window)) {
        alert("Speech not supported in this browser.");
        return;
      }
      const utterance = new SpeechSynthesisUtterance(currentPhrase.hanzi);
      utterance.lang = "zh-CN";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }

    function toggleFavorite() {
      if (!currentPhrase) return;
      const key = makeKey(currentPhrase);
      if (favoriteKeys.has(key)) {
        favoriteKeys.delete(key);
      } else {
        favoriteKeys.add(key);
      }
      updateFavoriteButton();

      // if currently in favorites mode and we removed it, refresh the pool
      if (currentMode === "favorites") {
        currentList = getPhrasesForMode("favorites");
        if (!currentList.length) {
          setMode("favorites");
          return;
        }
        shuffled = shuffleArray(currentList);
        index = 0;
        fillPhrase();
      }
    }

    // ---------- EVENT HOOKUP ----------
    document.querySelectorAll(".mode-btn").forEach(btn => {
      btn.addEventListener("click", () => setMode(btn.dataset.mode));
    });

    document.getElementById("newPhraseBtn").addEventListener("click", nextPhrase);
    document.getElementById("toggleRevealBtn").addEventListener("click", toggleReveal);
    testModeBtn.addEventListener("click", toggleTestMode);
    audioBtn.addEventListener("click", playAudio);
    favoriteBtn.addEventListener("click", toggleFavorite);

    // ---------- INITIALIZE ----------
    setMode("all");
  </script>
</body>
</html>
