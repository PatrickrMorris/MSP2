<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MSP â€“ Mandarin Practice v3.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      min-height: 100vh;
      align-items: stretch;
      justify-content: center;
    }
    .app {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
      padding: 16px 16px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .card {
      background: radial-gradient(circle at top, #1e293b, #020617);
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.18);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .title-block h1 {
      font-size: 1.2rem;
      margin: 0;
      letter-spacing: 0.02em;
    }
    .title-block p {
      margin: 2px 0 0;
      font-size: 0.78rem;
      color: #9ca3af;
    }
    .pill {
      font-size: 0.72rem;
      padding: 4px 8px;
      background: rgba(56, 189, 248, 0.1);
      color: #38bdf8;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.4);
      white-space: nowrap;
    }
    .mode-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .mode-btn {
      flex: 1 1 30%;
      min-width: 30%;
      font-size: 0.8rem;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.94);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .mode-btn span.icon { font-size: 0.95rem; }
    .mode-btn.active {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background: radial-gradient(circle at top left,
        rgba(56, 189, 248, 0.2),
        rgba(15, 23, 42, 0.98));
    }

    .phrase-card {
      margin-top: 8px;
      padding: 14px 12px;
      border-radius: 14px;
      background: linear-gradient(
        135deg,
        rgba(15, 118, 110, 0.25),
        rgba(30, 64, 175, 0.7)
      );
      border: 1px solid rgba(56, 189, 248, 0.45);
    }

    .phrase-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #cbd5f5;
    }
    .small-label {
      font-size: 0.75rem;
      color: #d1d5db;
      opacity: 0.9;
      text-align: right;
    }

    .hanzi {
      font-size: 1.6rem;
      margin: 4px 0 2px;
      line-height: 1.3;
    }
    .pinyin {
      font-size: 0.95rem;
      color: #d1fae5;
      margin: 0 0 4px;
    }
    .english {
      font-size: 0.9rem;
      color: #e5e7eb;
      opacity: 0.97;
      margin: 0;
    }

    .controls-row-main,
    .controls-row-secondary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .primary-btn,
    .ghost-btn,
    .icon-btn {
      font-size: 0.8rem;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.6);
      background: rgba(8, 47, 73, 0.9);
      color: #e0f2fe;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex: 1;
      min-width: 0;
      text-align: center;
    }
    .ghost-btn {
      background: transparent;
      border-color: rgba(148, 163, 184, 0.7);
      color: #d1d5db;
    }
    .icon-btn {
      flex: 0 0 auto;
      padding: 8px 10px;
    }
    .primary-btn:active,
    .ghost-btn:active,
    .icon-btn:active,
    .mode-btn:active {
      transform: translateY(1px);
      opacity: 0.85;
    }

    .footer {
      margin-top: auto;
      font-size: 0.7rem;
      text-align: center;
      color: #6b7280;
    }
    .hidden { display: none; }

    @media (min-width: 600px) {
      .app { padding-top: 32px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="card">
      <div class="header">
        <div class="title-block">
          <h1>MSP Â· Mandarin v3.0</h1>
          <p>HSK1â€“2 + Everyday + Retail + Pharmacy Â· Test + Audio + Favorites</p>
        </div>
        <div class="pill">Drill mode</div>
      </div>

      <div class="mode-row">
        <button class="mode-btn active" data-mode="all"><span class="icon">ğŸ²</span><span>All</span></button>
        <button class="mode-btn" data-mode="everyday"><span class="icon">ğŸŒ¤ï¸</span><span>Everyday</span></button>
        <button class="mode-btn" data-mode="retail"><span class="icon">ğŸ›’</span><span>Retail</span></button>
        <button class="mode-btn" data-mode="pharmacy"><span class="icon">ğŸ’Š</span><span>Pharmacy</span></button>
        <button class="mode-btn" data-mode="hsk1"><span class="icon">â‘ </span><span>HSK 1</span></button>
        <button class="mode-btn" data-mode="hsk2"><span class="icon">â‘¡</span><span>HSK 2</span></button>
        <button class="mode-btn" data-mode="favorites"><span class="icon">â­</span><span>Favorites</span></button>
      </div>

      <div class="phrase-card" id="phraseCard">
        <div class="phrase-top-row">
          <span class="tag" id="categoryTag">Warm-up</span>
          <span class="small-label" id="indexLabel">Seen 0 / 0</span>
        </div>

        <div>
          <div class="hanzi" id="hanzi">ç‚¹å‡»â€œæ–°çŸ­è¯­â€</div>
          <div class="pinyin" id="pinyin">DiÇnâ€‹jÄ« â€œxÄ«n duÇnyÇ”â€</div>
          <p class="english" id="english">Tap "New phrase" to begin.</p>
        </div>

        <div class="controls-row-main">
          <button class="primary-btn" id="newPhraseBtn">ğŸ” New phrase</button>
          <button class="ghost-btn" id="toggleRevealBtn">ğŸ‘ Hide meaning</button>
        </div>

        <div class="controls-row-secondary">
          <button class="ghost-btn" id="testModeBtn">ğŸ§ª Test mode: Off</button>
          <button class="icon-btn" id="favoriteBtn">â˜† Fav</button>
          <button class="icon-btn" id="audioBtn">ğŸ”Š</button>
        </div>
      </div>
    </section>

    <div class="footer">
      MSP v3.0 Â· Smart Random Â· Test mode Â· Audio Â· Favorites Â· Best used as a Home Screen icon.
    </div>
  </div>

  <script>
    // ------------------------------
    // PHRASE BANK
    // ------------------------------
    const phrases = [
      // ---------- EVERYDAY ----------
      { category: "everyday", label: "Everyday Â· Greeting", hanzi: "ä½ å¥½ã€‚", pinyin: "NÇ hÇo.", english: "Hello." },
      { category: "everyday", label: "Everyday Â· Greeting", hanzi: "æ—©ä¸Šå¥½ã€‚", pinyin: "ZÇoshang hÇo.", english: "Good morning." },
      { category: "everyday", label: "Everyday Â· Greeting", hanzi: "æ™šä¸Šå¥½ã€‚", pinyin: "WÇnshang hÇo.", english: "Good evening." },
      { category: "everyday", label: "Everyday Â· Polite", hanzi: "è°¢è°¢ã€‚", pinyin: "XiÃ¨xie.", english: "Thank you." },
      { category: "everyday", label: "Everyday Â· Polite", hanzi: "ä¸å¥½æ„æ€ã€‚", pinyin: "BÃ¹ hÇoyÃ¬si.", english: "Excuse me / Sorry (polite)." },
      { category: "everyday", label: "Everyday Â· Polite", hanzi: "å¯¹ä¸èµ·ã€‚", pinyin: "DuÃ¬buqÇ.", english: "Iâ€™m sorry." },
      { category: "everyday", label: "Everyday Â· Polite", hanzi: "æ²¡å…³ç³»ã€‚", pinyin: "MÃ©i guÄnxi.", english: "It's okay / No problem." },
      { category: "everyday", label: "Everyday Â· Ask repeat", hanzi: "å¯ä»¥å†è¯´ä¸€éå—ï¼Ÿ", pinyin: "KÄ›yÇ zÃ i shuÅ yÃ­ biÃ n ma?", english: "Could you say that again?" },
      { category: "everyday", label: "Everyday Â· Slow", hanzi: "å¯ä»¥è¯´æ…¢ä¸€ç‚¹å—ï¼Ÿ", pinyin: "KÄ›yÇ shuÅ mÃ n yÃ¬diÇn ma?", english: "Can you speak a bit slower?" },
      { category: "everyday", label: "Everyday Â· Donâ€™t understand", hanzi: "æˆ‘å¬ä¸æ‡‚ã€‚", pinyin: "WÇ’ tÄ«ng bÃ¹ dÇ’ng.", english: "I donâ€™t understand (hearing)." },
      { category: "everyday", label: "Everyday Â· Donâ€™t understand", hanzi: "æˆ‘çœ‹ä¸æ‡‚ã€‚", pinyin: "WÇ’ kÃ n bÃ¹ dÇ’ng.", english: "I donâ€™t understand (reading)." },
      { category: "everyday", label: "Everyday Â· Meaning", hanzi: "è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ", pinyin: "ZhÃ¨ shÃ¬ shÃ©nme yÃ¬si?", english: "What does this mean?" },
      { category: "everyday", label: "Everyday Â· Name", hanzi: "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ", pinyin: "NÇ jiÃ o shÃ©nme mÃ­ngzi?", english: "What is your name?" },
      { category: "everyday", label: "Everyday Â· Name", hanzi: "æˆ‘å«â€¦â€¦ã€‚", pinyin: "WÇ’ jiÃ o â€¦â€¦.", english: "My name is â€¦" },
      { category: "everyday", label: "Everyday Â· From", hanzi: "ä½ æ˜¯å“ªå›½äººï¼Ÿ", pinyin: "NÇ shÃ¬ nÇ guÃ³ rÃ©n?", english: "Which country are you from?" },
      { category: "everyday", label: "Everyday Â· From", hanzi: "æˆ‘æ˜¯ç¾å›½äººã€‚", pinyin: "WÇ’ shÃ¬ MÄ›iguÃ³ rÃ©n.", english: "Iâ€™m American." },
      { category: "everyday", label: "Everyday Â· Live", hanzi: "ä½ ä½åœ¨å“ªå„¿ï¼Ÿ", pinyin: "NÇ zhÃ¹ zÃ i nÇr?", english: "Where do you live?" },
      { category: "everyday", label: "Everyday Â· Live", hanzi: "æˆ‘ä½åœ¨ä¼Šåˆ©è¯ºä¼Šå·ã€‚", pinyin: "WÇ’ zhÃ¹ zÃ i YÄ«lÃ¬nuÃ²yÄ« zhÅu.", english: "I live in Illinois." },
      { category: "everyday", label: "Everyday Â· Language", hanzi: "ä½ ä¼šè¯´æ±‰è¯­å—ï¼Ÿ", pinyin: "NÇ huÃ¬ shuÅ HÃ nyÇ” ma?", english: "Can you speak Chinese?" },
      { category: "everyday", label: "Everyday Â· Language", hanzi: "æˆ‘ä¼šè¯´ä¸€ç‚¹å„¿ã€‚", pinyin: "WÇ’ huÃ¬ shuÅ yÃ¬diÇnr.", english: "I can speak a little." },
      { category: "everyday", label: "Everyday Â· Busy", hanzi: "ä½ ä»Šå¤©å¿™å—ï¼Ÿ", pinyin: "NÇ jÄ«ntiÄn mÃ¡ng ma?", english: "Are you busy today?" },
      { category: "everyday", label: "Everyday Â· Busy", hanzi: "æˆ‘æœ‰ç‚¹å„¿å¿™ã€‚", pinyin: "WÇ’ yÇ’udiÇnr mÃ¡ng.", english: "Iâ€™m a bit busy." },
      { category: "everyday", label: "Everyday Â· Job", hanzi: "ä½ åšä»€ä¹ˆå·¥ä½œï¼Ÿ", pinyin: "NÇ zuÃ² shÃ©nme gÅngzuÃ²?", english: "What do you do for work?" },
      { category: "everyday", label: "Everyday Â· Bathroom", hanzi: "è¯·é—®ï¼Œå•æ‰€åœ¨å“ªå„¿ï¼Ÿ", pinyin: "QÇngwÃ¨n, cÃ¨suÇ’ zÃ i nÇr?", english: "Where is the bathroom?" },
      { category: "everyday", label: "Everyday Â· Tired", hanzi: "æˆ‘æœ‰ç‚¹å„¿ç´¯ã€‚", pinyin: "WÇ’ yÇ’udiÇnr lÃ¨i.", english: "Iâ€™m a bit tired." },
      { category: "everyday", label: "Everyday Â· Like", hanzi: "æˆ‘å¾ˆå–œæ¬¢è¿™ä¸ªã€‚", pinyin: "WÇ’ hÄ›n xÇhuan zhÃ¨ge.", english: "I really like this." },
      { category: "everyday", label: "Everyday Â· Donâ€™t like", hanzi: "æˆ‘ä¸å¤ªå–œæ¬¢ã€‚", pinyin: "WÇ’ bÃº tÃ i xÇhuan.", english: "I donâ€™t really like it." },

      // ---------- RETAIL ----------
      { category: "retail", label: "Retail Â· Help", hanzi: "éœ€è¦å¸®å¿™å—ï¼Ÿ", pinyin: "XÅ«yÃ o bÄngmÃ¡ng ma?", english: "Do you need help?" },
      { category: "retail", label: "Retail Â· Help", hanzi: "æˆ‘å¯ä»¥å¸®ä½ æ‰¾ã€‚", pinyin: "WÇ’ kÄ›yÇ bÄng nÇ zhÇo.", english: "I can help you find it." },
      { category: "retail", label: "Retail Â· Location", hanzi: "è¿™ä¸ªåœ¨é‚£è¾¹çš„è´§æ¶ä¸Šã€‚", pinyin: "ZhÃ¨ge zÃ i nÃ biÄn de huÃ²jiÃ  shÃ ng.", english: "It's on the shelf over there." },
      { category: "retail", label: "Retail Â· Sale", hanzi: "ä»Šå¤©è¿™äº›åœ¨æ‰“æŠ˜ã€‚", pinyin: "JÄ«ntiÄn zhÃ¨xiÄ“ zÃ i dÇzhÃ©.", english: "These are on sale today." },
      { category: "retail", label: "Retail Â· Card", hanzi: "ä½ æœ‰ä¼šå‘˜å¡å—ï¼Ÿ", pinyin: "NÇ yÇ’u huÃ¬yuÃ¡n kÇ ma?", english: "Do you have a rewards card?" },
      { category: "retail", label: "Retail Â· Price check", hanzi: "æˆ‘å¸®ä½ çœ‹ä¸€ä¸‹ä»·é’±ã€‚", pinyin: "WÇ’ bÄng nÇ kÃ n yÃ­xiÃ  jiÃ qiÃ¡n.", english: "I'll check the price for you." },
      { category: "retail", label: "Retail Â· Out of stock", hanzi: "è¿™ä¸ªç°åœ¨æ²¡æœ‰è´§äº†ã€‚", pinyin: "ZhÃ¨ge xiÃ nzÃ i mÃ©iyÇ’u huÃ² le.", english: "We're out of stock right now." },
      { category: "retail", label: "Retail Â· Back room", hanzi: "æˆ‘å»åé¢å¸®ä½ çœ‹çœ‹ã€‚", pinyin: "WÇ’ qÃ¹ hÃ²umiÃ n bÄng nÇ kÃ nkan.", english: "I'll check in the back." },
      { category: "retail", label: "Retail Â· Other size", hanzi: "ä½ è¦åˆ«çš„é¢œè‰²æˆ–è€…å¤§å°å—ï¼Ÿ", pinyin: "NÇ yÃ o biÃ© de yÃ¡nsÃ¨ huÃ²zhÄ› dÃ xiÇo ma?", english: "Do you want another size or color?" },
      { category: "retail", label: "Retail Â· Receipt", hanzi: "ä½ è¦å°ç¥¨å—ï¼Ÿ", pinyin: "NÇ yÃ o xiÇopiÃ o ma?", english: "Would you like a receipt?" },
      { category: "retail", label: "Retail Â· Line", hanzi: "è¯·åœ¨è¿™é‡Œæ’é˜Ÿã€‚", pinyin: "QÇng zÃ i zhÃ¨lÇ pÃ¡iduÃ¬.", english: "Please line up here." },
      { category: "retail", label: "Retail Â· Cash or card", hanzi: "ä½ ç”¨ç°é‡‘è¿˜æ˜¯åˆ·å¡ï¼Ÿ", pinyin: "NÇ yÃ²ng xiÃ njÄ«n hÃ¡ishÃ¬ shuÄkÇ?", english: "Cash or card?" },

      // ---------- PHARMACY ----------
      { category: "pharmacy", label: "Pharmacy Â· Purpose", hanzi: "ä½ åœ¨æ‹¿å¤„æ–¹è¯è¿˜æ˜¯ä¹°åˆ«çš„ï¼Ÿ", pinyin: "NÇ zÃ i nÃ¡ chÇ”fÄng yÃ o hÃ¡ishÃ¬ mÇi biÃ© de?", english: "Are you picking up a prescription or something else?" },
      { category: "pharmacy", label: "Pharmacy Â· DOB", hanzi: "ä½ çš„ç”Ÿæ—¥æ˜¯å‡ æœˆå‡ å·ï¼Ÿ", pinyin: "NÇ de shÄ“ngrÃ¬ shÃ¬ jÇ yuÃ¨ jÇ hÃ o?", english: "What is your date of birth?" },
      { category: "pharmacy", label: "Pharmacy Â· Name confirm", hanzi: "è¯·è¯´ä¸€ä¸‹ä½ çš„åå­—ã€‚", pinyin: "QÇng shuÅ yÃ­xiÃ  nÇ de mÃ­ngzi.", english: "Please tell me your name." },
      { category: "pharmacy", label: "Pharmacy Â· Allergies", hanzi: "ä½ å¯¹ä»€ä¹ˆè¯è¿‡æ•å—ï¼Ÿ", pinyin: "NÇ duÃ¬ shÃ©nme yÃ o guÃ²mÇn ma?", english: "Are you allergic to any medicine?" },
      { category: "pharmacy", label: "Pharmacy Â· New vs refill", hanzi: "è¿™æ˜¯æ–°å¤„æ–¹è¿˜æ˜¯ç»­è¯ï¼Ÿ", pinyin: "ZhÃ¨ shÃ¬ xÄ«n chÇ”fÄng hÃ¡ishÃ¬ xÃ¹ yÃ o?", english: "Is this a new prescription or a refill?" },
      { category: "pharmacy", label: "Pharmacy Â· Wait time", hanzi: "å¤§æ¦‚è¦åäº”åˆ°äºŒååˆ†é’Ÿã€‚", pinyin: "DÃ gÃ i yÃ o shÃ­wÇ” dÃ o Ã¨rshÃ­ fÄ“nzhÅng.", english: "Itâ€™ll take about 15â€“20 minutes." },
      { category: "pharmacy", label: "Pharmacy Â· Directions", hanzi: "ä¸€å¤©åƒä¸¤æ¬¡ï¼Œæ¯æ¬¡ä¸€ç‰‡ã€‚", pinyin: "YÃ¬tiÄn chÄ« liÇng cÃ¬, mÄ›i cÃ¬ yÃ­ piÃ n.", english: "Take it twice a day, one tablet each time." },
      { category: "pharmacy", label: "Pharmacy Â· With food", hanzi: "æœ€å¥½è·Ÿé¥­ä¸€èµ·åƒã€‚", pinyin: "ZuÃ¬ hÇo gÄ“n fÃ n yÃ¬qÇ chÄ«.", english: "Take it with food." },
      { category: "pharmacy", label: "Pharmacy Â· Before bed", hanzi: "ç¡è§‰å‰åƒã€‚", pinyin: "ShuÃ¬jiÃ o qiÃ¡n chÄ«.", english: "Take it before bed." },
      { category: "pharmacy", label: "Pharmacy Â· As needed", hanzi: "ä¸èˆ’æœçš„æ—¶å€™å†åƒã€‚", pinyin: "BÃ¹ shÅ«fu de shÃ­hou zÃ i chÄ«.", english: "Take it when you feel unwell." },
      { category: "pharmacy", label: "Pharmacy Â· Interpreter", hanzi: "éœ€è¦æˆ‘å¸®ä½ å«ç¿»è¯‘å—ï¼Ÿ", pinyin: "XÅ«yÃ o wÇ’ bÄng nÇ jiÃ o fÄnyÃ¬ ma?", english: "Do you need an interpreter?" },
      { category: "pharmacy", label: "Pharmacy Â· OTC", hanzi: "ä½ æ˜¯åœ¨æ‰¾å“ªä¸€ç§è¯ï¼Ÿ", pinyin: "NÇ shÃ¬ zÃ i zhÇo nÇ yÃ¬ zhÇ’ng yÃ o?", english: "Which medicine are you looking for?" },
      { category: "pharmacy", label: "Pharmacy Â· Flu shot", hanzi: "ä½ ä»Šå¤©è¦æ‰“æµæ„Ÿç–«è‹—å—ï¼Ÿ", pinyin: "NÇ jÄ«ntiÄn yÃ o dÇ liÃºgÇn yÃ¬miÃ¡o ma?", english: "Do you want a flu shot today?" },
      { category: "pharmacy", label: "Pharmacy Â· Vaccine area", hanzi: "æ‰“é’ˆçš„åœ°æ–¹åœ¨é‚£è¾¹ï¼Œè¯·è·Ÿæˆ‘æ¥ã€‚", pinyin: "DÇzhÄ“n de dÃ¬fang zÃ i nÃ biÄn, qÇng gÄ“n wÇ’ lÃ¡i.", english: "The vaccination area is over there, please follow me." },
      { category: "pharmacy", label: "Pharmacy Â· Side effects", hanzi: "æ‰“é’ˆä»¥åæ‰‹è‡‚å¯èƒ½ä¼šæœ‰ç‚¹å„¿ç–¼ã€‚", pinyin: "DÇzhÄ“n yÇhÃ²u shÇ’ubÃ¬ kÄ›nÃ©ng huÃ¬ yÇ’udiÇnr tÃ©ng.", english: "Your arm may be a bit sore afterwards." },

      // ---------- HSK 1 ----------
      { category: "hsk1", label: "HSK1 Â· Hello", hanzi: "ä½ å¥½ã€‚", pinyin: "NÇ hÇo.", english: "Hello." },
      { category: "hsk1", label: "HSK1 Â· How are you", hanzi: "ä½ å¥½å—ï¼Ÿ", pinyin: "NÇ hÇo ma?", english: "How are you?" },
      { category: "hsk1", label: "HSK1 Â· Reply", hanzi: "æˆ‘å¾ˆå¥½ï¼Œä½ å‘¢ï¼Ÿ", pinyin: "WÇ’ hÄ›n hÇo, nÇ ne?", english: "Iâ€™m very good, and you?" },
      { category: "hsk1", label: "HSK1 Â· Goodbye", hanzi: "å†è§ã€‚", pinyin: "ZÃ ijiÃ n.", english: "Goodbye." },
      { category: "hsk1", label: "HSK1 Â· Thanks", hanzi: "è°¢è°¢ã€‚", pinyin: "XiÃ¨xie.", english: "Thank you." },
      { category: "hsk1", label: "HSK1 Â· Welcome", hanzi: "ä¸å®¢æ°”ã€‚", pinyin: "BÃº kÃ¨qi.", english: "Youâ€™re welcome." },
      { category: "hsk1", label: "HSK1 Â· Sorry", hanzi: "å¯¹ä¸èµ·ã€‚", pinyin: "DuÃ¬buqÇ.", english: "Sorry." },
      { category: "hsk1", label: "HSK1 Â· No problem", hanzi: "æ²¡å…³ç³»ã€‚", pinyin: "MÃ©i guÄnxi.", english: "Itâ€™s okay / No problem." },
      { category: "hsk1", label: "HSK1 Â· Bathroom", hanzi: "è¯·é—®ï¼Œå•æ‰€åœ¨å“ªå„¿ï¼Ÿ", pinyin: "QÇngwÃ¨n, cÃ¨suÇ’ zÃ i nÇr?", english: "Where is the bathroom?" },
      { category: "hsk1", label: "HSK1 Â· Time", hanzi: "ç°åœ¨å‡ ç‚¹ï¼Ÿ", pinyin: "XiÃ nzÃ i jÇ diÇn?", english: "What time is it?" },
      { category: "hsk1", label: "HSK1 Â· Today date", hanzi: "ä»Šå¤©å‡ å·ï¼Ÿ", pinyin: "JÄ«ntiÄn jÇ hÃ o?", english: "What date is it today?" },
      { category: "hsk1", label: "HSK1 Â· From", hanzi: "ä½ æ˜¯å“ªå›½äººï¼Ÿ", pinyin: "NÇ shÃ¬ nÇ guÃ³ rÃ©n?", english: "Which country are you from?" },
      { category: "hsk1", label: "HSK1 Â· Live", hanzi: "ä½ ä½åœ¨å“ªå„¿ï¼Ÿ", pinyin: "NÇ zhÃ¹ zÃ i nÇr?", english: "Where do you live?" },

      // ---------- HSK 2 ----------
      { category: "hsk2", label: "HSK2 Â· Transport", hanzi: "ä½ æ€ä¹ˆæ¥è¿™å„¿ï¼Ÿ", pinyin: "NÇ zÄ›nme lÃ¡i zhÃ¨r?", english: "How did you get here?" },
      { category: "hsk2", label: "HSK2 Â· Bus", hanzi: "æˆ‘åå…¬äº¤è½¦æ¥ã€‚", pinyin: "WÇ’ zuÃ² gÅngjiÄochÄ“ lÃ¡i.", english: "I came by bus." },
      { category: "hsk2", label: "HSK2 Â· Car", hanzi: "æˆ‘å¼€è½¦æ¥ã€‚", pinyin: "WÇ’ kÄichÄ“ lÃ¡i.", english: "I drove here." },
      { category: "hsk2", label: "HSK2 Â· Weekend", hanzi: "ä½ å‘¨æœ«å–œæ¬¢åšä»€ä¹ˆï¼Ÿ", pinyin: "NÇ zhÅumÃ² xÇhuan zuÃ² shÃ©nme?", english: "What do you like to do on weekends?" },
      { category: "hsk2", label: "HSK2 Â· Study", hanzi: "ä½ åœ¨å­¦ä»€ä¹ˆï¼Ÿ", pinyin: "NÇ zÃ i xuÃ© shÃ©nme?", english: "What are you studying?" },
      { category: "hsk2", label: "HSK2 Â· Study CN", hanzi: "æˆ‘åœ¨å­¦ä¸­æ–‡ã€‚", pinyin: "WÇ’ zÃ i xuÃ© ZhÅngwÃ©n.", english: "Iâ€™m studying Chinese." },
      { category: "hsk2", label: "HSK2 Â· Hard but fun", hanzi: "æœ‰ä¸€ç‚¹å„¿éš¾ï¼Œä½†æ˜¯å¾ˆæœ‰æ„æ€ã€‚", pinyin: "YÇ’u yÃ¬diÇnr nÃ¡n, dÃ nshÃ¬ hÄ›n yÇ’uyÃ¬si.", english: "Itâ€™s a bit hard, but very interesting." },
      { category: "hsk2", label: "HSK2 Â· Duration", hanzi: "ä½ æ¯å¤©å­¦ä¹ å¤šé•¿æ—¶é—´ï¼Ÿ", pinyin: "NÇ mÄ›itiÄn xuÃ©xÃ­ duÅ chÃ¡ng shÃ­jiÄn?", english: "How long do you study every day?" },
      { category: "hsk2", label: "HSK2 Â· One hour", hanzi: "æˆ‘æ¯å¤©å­¦ä¹ ä¸€ä¸ªå°æ—¶ã€‚", pinyin: "WÇ’ mÄ›itiÄn xuÃ©xÃ­ yÃ­ ge xiÇoshÃ­.", english: "I study one hour every day." },
      { category: "hsk2", label: "HSK2 Â· HSK exam", hanzi: "æˆ‘æƒ³å‚åŠ HSKè€ƒè¯•ã€‚", pinyin: "WÇ’ xiÇng cÄnjiÄ HSK kÇoshÃ¬.", english: "I want to take the HSK exam." },
      { category: "hsk2", label: "HSK2 Â· Level", hanzi: "ä½ å‡†å¤‡è€ƒHSKå‡ çº§ï¼Ÿ", pinyin: "NÇ zhÇ”nbÃ¨i kÇo HSK jÇ jÃ­?", english: "Which HSK level are you preparing for?" },
      { category: "hsk2", label: "HSK2 Â· Level 2", hanzi: "æˆ‘å‡†å¤‡è€ƒHSKäºŒçº§ã€‚", pinyin: "WÇ’ zhÇ”nbÃ¨i kÇo HSK Ã¨r jÃ­.", english: "Iâ€™m preparing for HSK Level 2." }
    ];

    // Add IDs to each phrase for favorites
    phrases.forEach((p, idx) => p.id = idx);

    // ------------------------------
    // STATE
    // ------------------------------
    let currentMode = "all";
    let currentList = [];
    let shuffled = [];
    let currentIndex = 0;
    let revealed = true;
    let testMode = false;
    let currentPhrase = null;

    const FAVORITES_KEY = "mspFavoritesV3";
    let favorites = loadFavorites();

    // ------------------------------
    // DOM ELEMENTS
    // ------------------------------
    const modeButtons = document.querySelectorAll(".mode-btn");
    const hanziEl = document.getElementById("hanzi");
    const pinyinEl = document.getElementById("pinyin");
    const englishEl = document.getElementById("english");
    const categoryTagEl = document.getElementById("categoryTag");
    const indexLabelEl = document.getElementById("indexLabel");
    const newPhraseBtn = document.getElementById("newPhraseBtn");
    const toggleRevealBtn = document.getElementById("toggleRevealBtn");
    const testModeBtn = document.getElementById("testModeBtn");
    const favoriteBtn = document.getElementById("favoriteBtn");
    const audioBtn = document.getElementById("audioBtn");

    // ------------------------------
    // FAVORITES STORAGE
    // ------------------------------
    function loadFavorites() {
      try {
        const raw = localStorage.getItem(FAVORITES_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed;
        return [];
      } catch {
        return [];
      }
    }

    function saveFavorites() {
      try {
        localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
      } catch {
        // ignore
      }
    }

    function isFavorite(id) {
      return favorites.includes(id);
    }

    function toggleFavorite() {
      if (!currentPhrase) return;
      const id = currentPhrase.id;
      if (isFavorite(id)) {
        favorites = favorites.filter(f => f !== id);
      } else {
        favorites.push(id);
      }
      saveFavorites();
      updateFavoriteButton();
      if (currentMode === "favorites") {
        // refresh list for favorites mode
        setMode("favorites");
      }
    }

    function updateFavoriteButton() {
      if (!currentPhrase) {
        favoriteBtn.textContent = "â˜† Fav";
        return;
      }
      if (isFavorite(currentPhrase.id)) {
        favoriteBtn.textContent = "â˜… Favâ€™d";
      } else {
        favoriteBtn.textContent = "â˜† Fav";
      }
    }

    // ------------------------------
    // MODE & PHRASE SELECTION
    // ------------------------------
    function getListForMode(mode) {
      if (mode === "all") return phrases;
      if (mode === "favorites") {
        return phrases.filter(p => favorites.includes(p.id));
      }
      return phrases.filter(p => p.category === mode);
    }

    function shuffleArray(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function setMode(mode) {
      currentMode = mode;
      modeButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });

      currentList = getListForMode(mode);

      if (currentList.length === 0) {
        currentPhrase = null;
        hanziEl.textContent = mode === "favorites"
          ? "è¿˜æ²¡æœ‰æ”¶è—çš„çŸ­è¯­ã€‚"
          : "è¿™ä¸ªæ¨¡å¼è¿˜æ²¡æœ‰çŸ­è¯­ã€‚";
        pinyinEl.textContent = mode === "favorites"
          ? "HÃ¡i mÃ©iyÇ’u shÅucÃ¡ng de duÇnyÇ”."
          : "ZhÃ¨ge mÃ³shÃ¬ hÃ¡i mÃ©iyÇ’u duÇnyÇ”.";
        englishEl.textContent = mode === "favorites"
          ? "You don't have any favorites yet."
          : "No phrases in this mode yet.";
        indexLabelEl.textContent = "Seen 0 / 0";
        categoryTagEl.textContent = modeLabel(mode);
        updateFavoriteButton();
        return;
      }

      shuffled = shuffleArray(currentList);
      currentIndex = 0;
      categoryTagEl.textContent = modeLabel(mode);
      showCurrent();
    }

    function modeLabel(mode) {
      switch (mode) {
        case "everyday": return "Everyday Â· Smart random";
        case "retail": return "Retail Â· Smart random";
        case "pharmacy": return "Pharmacy Â· Smart random";
        case "hsk1": return "HSK 1 Â· Smart random";
        case "hsk2": return "HSK 2 Â· Smart random";
        case "favorites": return "Favorites Â· Smart random";
        default: return "All Â· Mixed";
      }
    }

    function showCurrent() {
      if (!currentList.length) return;

      currentPhrase = shuffled[currentIndex];
      hanziEl.textContent = currentPhrase.hanzi;
      pinyinEl.textContent = currentPhrase.pinyin;
      englishEl.textContent = currentPhrase.english;

      categoryTagEl.textContent = currentPhrase.label
        ? currentPhrase.label
        : modeLabel(currentMode);

      indexLabelEl.textContent = `Seen ${currentIndex + 1} / ${currentList.length}`;

      // apply reveal/test state
      if (testMode) {
        revealed = false;
      }

      pinyinEl.style.display = revealed ? "block" : "none";
      englishEl.style.display = revealed ? "block" : "none";
      toggleRevealBtn.textContent = revealed ? "ğŸ‘ Hide meaning" : "ğŸ‘ Show meaning";

      updateFavoriteButton();
    }

    function nextPhrase() {
      if (!currentList.length) return;
      currentIndex++;
      if (currentIndex >= currentList.length) {
        shuffled = shuffleArray(currentList);
        currentIndex = 0;
      }
      showCurrent();
    }

    // ------------------------------
    // TEST MODE
    // ------------------------------
    function toggleTestMode() {
      testMode = !testMode;
      testModeBtn.textContent = testMode ? "ğŸ§ª Test mode: On" : "ğŸ§ª Test mode: Off";
      // When turning test mode on, hide meaning for current phrase
      if (testMode) {
        revealed = false;
      }
      showCurrent();
    }

    function toggleReveal() {
      revealed = !revealed;
      pinyinEl.style.display = revealed ? "block" : "none";
      englishEl.style.display = revealed ? "block" : "none";
      toggleRevealBtn.textContent = revealed ? "ğŸ‘ Hide meaning" : "ğŸ‘ Show meaning";
    }

    // ------------------------------
    // AUDIO / TTS
    // ------------------------------
    function speakCurrent() {
      if (!currentPhrase) return;
      if (!("speechSynthesis" in window)) {
        alert("Speech not supported in this browser.");
        return;
      }
      const utter = new SpeechSynthesisUtterance(currentPhrase.hanzi);
      utter.lang = "zh-CN";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    // ------------------------------
    // EVENT LISTENERS
    // ------------------------------
    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => setMode(btn.dataset.mode));
    });

    newPhraseBtn.addEventListener("click", nextPhrase);
    toggleRevealBtn.addEventListener("click", toggleReveal);
    testModeBtn.addEventListener("click", toggleTestMode);
    favoriteBtn.addEventListener("click", toggleFavorite);
    audioBtn.addEventListener("click", speakCurrent);

    // ------------------------------
    // INIT
    // ------------------------------
    setMode("all");
  </script>
</body>
</html>
